# 传统数据库到空间数据库的转变



## OGC SFSQL标准？？？？？？？？？？？？？



## GEOS

”**Geometry Engine, Open Source**“ （[GEOS](https://link.zhihu.com/?target=http%3A//trac.osgeo.org/geos)）出现了，GEOS库为实现SFSQL规范提供了必要的算法。





## 是什么使**普通数据库**变成**空间数据库**

- **空间数据库像存储和操作数据库中其他任何对象一样去存储和操作空间对象**。

- 将**空间数据**与数据库关联起来的三个要素：**数据类型**、**索引**和**函数**

  - **空间数据类型**用于指定图形为**点**（point）、**线**（line）和**面**（polygon）
  - 多维度**空间索引**被用于进行空间操作的高效处理（注意是多维度哦，而不是只有针对二维空间数据的索引）
  - **空间函数**构建于SQL语言中，用于进行空间属性和空间关系的查询

  **空间数据类型**、**空间索引**和**空间函数**组合在一起，提供了灵活的结构用于空间数据库的性能优化和分析。

  

### 发展历史

在传统的第一代**地理信息系统**（GIS）实现中，所有的**空间数据**都存储在**平面文件（关于平面文件-flat files可以查看这个链接：**[flat file_百度百科](https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/flat%20file/8599374)）中，需要专门的GIS软件来解释和操作这些数据。这些第一代管理系统旨在满足用户的需求，其中所有所需的数据都在用户的组织领域中。它们是专为处理**空间数据**而构建的专有的、独立的系统，即应用程序和平面文件之间的耦合性非常高，平面文件里的空间数据没有数据独立性。

第二代空间系统将一些数据存储在**关系数据库（RDBMS）**中（通常是“**属性**”或**非空间信息部分**），但仍然缺乏直接集成所具有的灵活性，包含空间信息部分的数据仍然没有数据独立性。

**真正的空间数据库诞生于人们开始把空间要素当作第一级数据库对象的时候**。

**空间数据库**将**空间数据**和**对象关系数据库**（Object Relational database）完全集成在一起。实现从以GIS为中心向以数据库为中心的转变。

![img](D:\WorkSpace\technologyNotes\pictures\传统数据库到空间数据库的转变\v2-5d0689aa5e0ccb5e09b2587eefac4bb3_720w.jpg)空间数据存储的体系架构的发展

从上图可以看出，有了空间数据库之后，就不再需要专门的GIS数据引擎（GIS Data Engine）去处理和操纵空间数据了，**应用程序只需要通过SQL语言就能轻松地操纵空间数据。**

**说明**：**空间数据库管理系统**也可用于地理信息以外的应用。例如，**空间数据库**可以用于管理与人体解剖、大规模集成电路、分子结构和电磁场等相关的数据。



### 空间数据类型

**普通数据库**拥有**字符串**（string）、**数值**（number）和**日期**（date）这些数据类型，**空间数据库**添加了额外的数据类型（空间数据类型）以用于表达**地理特征**（geographic features）。

这些**空间数据类型**抽象并封装了诸如**边界**（boundary）和**维度**（dimension）等空间结构。

在许多方面，**空间数据类型**可以简单的理解为**形状**（shape）

![img](D:\WorkSpace\technologyNotes\pictures\传统数据库到空间数据库的转变\v2-d69b86e7ed3e66f12e3603ed86dc9b08_720w.jpg)空间数据类型组织结构图

**空间数据类型**按类型层次结构组织。每个子类型继承其父类型的结构（属性）和行为（方法或函数）。



### **空间索引和边界框（bounding box）**

**普通数据库**提供**索引机制**以允许对数据子集进行快速、随机地访问。

标准的数据类型（number、string、date）的**索引**通常是[B-tree](https://link.zhihu.com/?target=http%3A//en.wikipedia.org/wiki/B-tree)索引（**B树索引**），**B树索引**使用自然排序顺序（natural sort order）对数据进行分区，以便将数据放入分层树中。

**数字**、**字符串**和**日期**的自然排序顺序很容易确定 —— 每个值都小于、大于或等于其他值。

但是由于**多边形**（Polygon）可以重叠，可以相互包含，并且可以排列在二维（或更多维数）空间中，因此无法使用**B树索引**有效地索引它们。

**空间数据库**提供了一个“**空间索引**（spatial index）”，它回答了“哪些对象在这个特定的边界框内？”这个问题。

**边界框**（bounding box）是平行于坐标轴且包含给定地理**要素**（feature）的最小的矩形。

![img](D:\WorkSpace\technologyNotes\pictures\传统数据库到空间数据库的转变\v2-88c840daf3e937d208b13c75e84de4fc_720w.jpg)边界框示例

使用**边界框**是为了判断”A被包含在B中吗？"这个问题，对多边形进行计算，计算量非常大而且难以计算，但在计算矩形的情况下，计算比较容易，而且速度非常快。

即使是最复杂的多边形和线串（LineString)也可以用一个简单的**边界框**来表示。

**索引**必须快速执行才能起到理想的作用。因此，**空间索引**不像**B树索引**那样提供精确的结果，而是提供近似的结果。

"多边形内部包含哪些线段“将由**空间索引**解释为”这个多边形**边界框**内部包含哪些线段**边界框**？“

各种数据库实际实现的**空间索引**差异很大，最常见的实现是[R-tree](https://link.zhihu.com/?target=http%3A//en.wikipedia.org/wiki/R-tree)（在PostGIS中使用），但在其他**空间数据库**中也有基于[四叉树](https://link.zhihu.com/?target=http%3A//en.wikipedia.org/wiki/Quadtree)（Quadtrees）的实现和[基于网格的索引](https://link.zhihu.com/?target=http%3A//en.wikipedia.org/wiki/Grid_(spatial_index))（grid-based indexes）的实现。

### **空间函数**

关于查询的数据操作，**普通数据库**提供的函数功能包括连接字符串、对字符串执行哈希操作、对数值进行数学运算以及从日期中提取信息等。

**空间数据库**为分析几何信息、确定空间关系和操作几何图形提供了一套完整的**空间函数。**

**空间函数**中的大部分可以被归纳为以下五类：

- 转换 —— 在geometry（PostGIS中存储空间信息的格式）和外部数据格式之间进行转换的函数
- 管理 —— 管理关于空间表和PostGIS组织的信息的函数
- 检索 —— 检索几何图形的属性和空间信息测量的函数
- 比较 —— 比较两种几何图形的空间关系的函数
- 生成 —— 基于其他几何图形生成新图形的函数

函数列表可能非常长，**[OGC](https://link.zhihu.com/?target=https%3A//postgis.net/workshops/postgis-intro/glossary.html%23term-ogc) [SFSQL](https://link.zhihu.com/?target=https%3A//postgis.net/workshops/postgis-intro/glossary.html%23term-sfsql)定义了一组通用空间函数规范**，PostGIS实现了这些规范（并另外实现了其他有用的空间函数）。

